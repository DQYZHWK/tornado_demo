# Medical_Classification

主诉查体诊疗计划识别，使用bilstm网络，基于pytorch,根据病例文本，识别 [主诉, 家族史, 传染病史, 手术史, 婚育史, 月经史, 预防接种史, 现病史,外伤史, 既往史, 个人史, 过去史, 输血史] 13种病例文本类别


### 词向量的准备
本实验使用开源词向量[*chinese-word-vectors*](https://github.com/Embedding/Chinese-Word-Vectors)
选用Baidu Encyclopedia（百度百科）训练得到Word Vector（300维度），提取训练语料中出现的字符对应的向量，输出Med_w2v.npz词向量表文件，9.2MB


## 实验参数/模型参数
* 机器：单卡V100 
* 模型：bilstm
* 训练时间：2分47秒 
* learning_rate = 6e-5
* epochs：10
* bilstm层数：2
* batch_size：8
* pad_size：32

* 数据集划分：

数据集|数据量
--|--
训练集|8557
验证集|1000
测试集|1000

* 模型参数文件大小：13MB


## 环境
python 3.8.0  
pytorch 2.1.0 
tqdm  
sklearn  
jieba  


## 模型效果

Test Loss: 0.086,  Test Acc: 95.90%

class|precision|recall|f1-score|support
--|--|--|--|--
   主诉|     1.0000|    1.0000|    1.0000|       100|
  家族史|     0.9770|    0.9884|    0.9827 |       86|
 传染病史|     1.0000 |   1.0000 |   1.0000|        87|
  手术史|     1.0000|    0.8533|    0.9209|        75|
  婚育史|     1.0000|    0.9902 |   0.9951 |      102|
  月经史|     1.0000|    1.0000 |   1.0000|        36|
预防接种史|     1.0000|    1.0000 |   1.0000 |       94|
  现病史|     0.9894|    1.0000 |   0.9947|        93|
  外伤史|     0.8833|    0.7067  |  0.7852|        75|
  既往史|     0.9540|    0.9765  |  0.9651|        85|
  个人史|     1.0000|    0.9625  |  0.9809|        80|
  过去史|     1.0000|    1.0000   | 1.0000|         1|
  输血史|     0.7589|    0.9884 |   0.8586|        86|
accuracy |   | |                    0.9590|      1000|
macro avg|     0.9664|    0.9589|    0.9602|      1000|
weighted avg |    0.9636|    0.9590|    0.9588|      1000| 

评价：较之前使用的bert模型相比，测试集准确率下降0.5%，模型体量方面从80MB减少到22.2MB，简化了模型复杂度，提高了平均处理时间

## 服务封装

在本地windows环境下单次请求平均处理时间0.03s，实现200个请求并发处理时间4.1s

[智能服务API文档](https://github.com/DQYZHWK/tornado_demo/blob/master/%E6%99%BA%E8%83%BD%E6%9C%8D%E5%8A%A11.md)
